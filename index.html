<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>くじ引きアプリ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #result { margin-top: 20px; font-size: 24px; font-weight: bold; }
    #history { margin-top: 30px; }
    #history li { margin-bottom: 5px; }
  </style>
</head>
<body>
  <h1>くじ引きアプリ</h1>
  <button id="drawBtn">今日の一人！</button>
  <div id="result"></div>
  <ul id="history"></ul>

  <script>
    let names = [];
    let historyList = [];

    // JSONを読み込む
    fetch("names.json")
      .then(response => response.json())
      .then(data => {
        names = [...data.names];

        // localStorageに履歴があれば復元
        const savedHistory = localStorage.getItem('history');
        if(savedHistory) {
          historyList = JSON.parse(savedHistory);
          // 履歴表示更新
          updateHistory();
          // 名前リストから履歴分を除外
          historyList.forEach(name => {
            const idx = names.indexOf(name);
            if(idx !== -1) names.splice(idx, 1);
          });
        }
      })
      .catch(err => console.error("読み込み失敗:", err));

    const drawBtn = document.getElementById("drawBtn");
    const resultDiv = document.getElementById("result");
    const historyUl = document.getElementById("history");

    drawBtn.addEventListener("click", () => {
      if(names.length === 0) {
        resultDiv.textContent = "もう抽選できる人がいません！";
        return;
      }

      resultDiv.textContent = "抽選中…";

      setTimeout(() => {
        const idx = Math.floor(Math.random() * names.length);
        const winner = names.splice(idx, 1)[0];
        historyList.unshift(winner); // 新しい順に上に追加
        localStorage.setItem('history', JSON.stringify(historyList)); // 保存

        resultDiv.textContent = `🎉 ${winner} 🎉`;
        updateHistory();
      }, 500);
    });

    function updateHistory() {
      historyUl.innerHTML = "";
      historyList.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        historyUl.appendChild(li);
      });
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãã˜å¼•ãã‚¢ãƒ—ãƒª</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #result { margin-top: 20px; font-size: 24px; font-weight: bold; }
    #history { margin-top: 30px; }
    #history li { margin-bottom: 5px; }
  </style>
</head>
<body>
  <h1>ãã˜å¼•ãã‚¢ãƒ—ãƒª</h1>
  <button id="drawBtn">ä»Šæ—¥ã®ä¸€äººï¼</button>
  <div id="result"></div>
  <ul id="history"></ul>

  <script>
    let names = [];
    let historyList = [];

    // JSONã‚’èª­ã¿è¾¼ã‚€
    fetch("names.json")
      .then(response => response.json())
      .then(data => {
        names = [...data.names];

        // localStorageã«å±¥æ­´ãŒã‚ã‚Œã°å¾©å…ƒ
        const savedHistory = localStorage.getItem('history');
        if(savedHistory) {
          historyList = JSON.parse(savedHistory);
          // å±¥æ­´è¡¨ç¤ºæ›´æ–°
          updateHistory();
          // åå‰ãƒªã‚¹ãƒˆã‹ã‚‰å±¥æ­´åˆ†ã‚’é™¤å¤–
          historyList.forEach(name => {
            const idx = names.indexOf(name);
            if(idx !== -1) names.splice(idx, 1);
          });
        }
      })
      .catch(err => console.error("èª­ã¿è¾¼ã¿å¤±æ•—:", err));

    const drawBtn = document.getElementById("drawBtn");
    const resultDiv = document.getElementById("result");
    const historyUl = document.getElementById("history");

    drawBtn.addEventListener("click", () => {
      if(names.length === 0) {
        resultDiv.textContent = "ã‚‚ã†æŠ½é¸ã§ãã‚‹äººãŒã„ã¾ã›ã‚“ï¼";
        return;
      }

      resultDiv.textContent = "æŠ½é¸ä¸­â€¦";

      setTimeout(() => {
        const idx = Math.floor(Math.random() * names.length);
        const winner = names.splice(idx, 1)[0];
        historyList.unshift(winner); // æ–°ã—ã„é †ã«ä¸Šã«è¿½åŠ 
        localStorage.setItem('history', JSON.stringify(historyList)); // ä¿å­˜

        resultDiv.textContent = `ğŸ‰ ${winner} ğŸ‰`;
        updateHistory();
      }, 500);
    });

    function updateHistory() {
      historyUl.innerHTML = "";
      historyList.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        historyUl.appendChild(li);
      });
    }
  </script>
</body>
</html>
